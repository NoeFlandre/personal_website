---
import { getCollection } from "astro:content";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import IconRss from "@/assets/icons/IconRss.svg";
import Card from "@/components/Card.astro";
import Footer from "@/components/Footer.astro";
import Header from "@/components/Header.astro";
import Hr from "@/components/Hr.astro";
import LinkButton from "@/components/LinkButton.astro";
import Socials from "@/components/Socials.astro";
import StructuredData from "@/components/StructuredData.astro";
import { SOCIALS } from "@/config";
import Layout from "@/layouts/Layout.astro";
import { getPath } from "@/utils/getPath";
import getSortedPosts from "@/utils/getSortedPosts";

const posts = await getCollection("blog");
const AIRBUS_GEO_EXPLORE_URL =
  "https://space-solutions.airbus.com/resources/news/various/airbus-geo-explore-early-testing-programme/";

const sortedPosts = getSortedPosts(posts);
const posts2024AndLater = sortedPosts.filter(({ data }) => data.pubDatetime.getFullYear() >= 2024);
const homepageFeaturedTitles = [
  "A survival guide in AI",
  "Can we turn agent-based models into empathetic stories (without getting poetic)?",
  "Can LLMs learn conceptual modeling from slide decks?",
];
const homepageFeaturedOrder = new Map(homepageFeaturedTitles.map((title, index) => [title, index]));
const featuredPosts = posts2024AndLater
  .filter(({ data }) => homepageFeaturedOrder.has(data.title))
  .sort(
    (a, b) =>
      (homepageFeaturedOrder.get(a.data.title) ?? Number.MAX_SAFE_INTEGER) -
      (homepageFeaturedOrder.get(b.data.title) ?? Number.MAX_SAFE_INTEGER)
  );
const publicationPost = featuredPosts.find(
  ({ data }) => data.title === "Can we turn agent-based models into empathetic stories (without getting poetic)?",
);
const featuredWorkCards = [
  {
    label: "Internship",
    title: "Airbus Defence and Space",
    description: "Fine-tuning of VLMs on satellite imagery and benchmark-driven training evaluation.",
    image: "/assets/img/about-map/airbus_defence_and_space_work.jpeg",
    href: AIRBUS_GEO_EXPLORE_URL,
  },
  {
    label: "Publication",
    title: "Empathetic Narratives from ABMs",
    description: "Research on turning agent-based simulations into readable, faithful stories with LLMs.",
    image: "/assets/img/about-map/miami_university_work.jpeg",
    href: publicationPost ? getPath(publicationPost.id, publicationPost.filePath) : "/posts",
  },
  {
    label: "Humanitarian Impact",
    title: "Tsiky Zanaka Classroom Project",
    description: "Classroom construction support in Namibia with field coordination and community partners.",
    image: "/assets/img/about-map/namibia_near_opuwo_humanitarian.jpeg",
    href: "https://tsikyzanaka.org/2025/02/09/projet-2023/",
  },
];
---

<Layout description="Noé Flandre: AI Research Engineer // Shipping side projects on GitHub - all open">
  <StructuredData type="WebSite" data={{}} />
  <StructuredData type="Person" data={{}} />
  <Header />
  <main id="main-content" data-layout="index">
    <section id="hero" class="pt-6 pb-4">
      <div class="flex flex-col sm:flex-row items-start gap-4">
        <a href="/about" class="block mx-auto sm:mx-0 group">
          <div class="w-40 h-40 rounded-full overflow-hidden flex-shrink-0 transition-all duration-300 group-hover:scale-105 group-hover:shadow-xl border-4 border-accent/10">
            <img
              src="/noe-avatar.jpg"
              alt="Noé Flandre"
              class="w-full h-full object-cover scale-[1.8] translate-x-[15%] translate-y-[-5%]"
            />
          </div>
        </a>
        <div class="flex-1 text-center sm:text-left">
          <div class="flex items-center gap-2 justify-center sm:justify-start">
            <h1 class="my-2 inline-block text-2xl font-bold sm:my-4 sm:text-3xl">
              Hi, I'm Noé.
            </h1>
            <a
              target="_blank"
              href="/rss.xml"
              class="inline-block"
              aria-label="rss feed"
              title="RSS Feed"
            >
              <IconRss
                width={20}
                height={20}
                class="scale-125 stroke-accent stroke-3"
              />
              <span class="sr-only">RSS Feed</span>
            </a>
          </div>
          <p>
            AI Research Engineer, vibe-learning<br />Daily meal : curating datasets & training models
          </p>
          {
            // only display if at least one social link is enabled
            SOCIALS.filter((social) => social.active).length > 0 && (
              <div class="mt-4 flex flex-row items-center justify-center sm:justify-start">
                <Socials />
              </div>
            )
          }
        </div>
      </div>
    </section>

    <section id="featured-work" class="pt-4 pb-8">
      <h2 class="text-2xl font-semibold tracking-wide">Featured Work</h2>
      <p class="mt-2 text-foreground/70">
        Selected work across industry, publications, and projects.
      </p>
      <div class="mt-6 grid grid-cols-1 gap-5 md:grid-cols-3">
        {featuredWorkCards.map((item) => (
          <a
            href={item.href}
            target={item.href.startsWith("http") ? "_blank" : undefined}
            rel={item.href.startsWith("http") ? "noopener noreferrer" : undefined}
            class="group overflow-hidden rounded-xl border border-border bg-card transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md"
          >
            <img
              src={item.image}
              alt={item.title}
              class="h-40 w-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
              loading="eager"
            />
            <div class="p-4">
              <span class="text-xs font-semibold uppercase tracking-[0.12em] text-accent/80">{item.label}</span>
              <h3 class="mt-2 text-lg font-semibold leading-tight">{item.title}</h3>
              <p class="mt-2 text-sm text-foreground/70">{item.description}</p>
            </div>
          </a>
        ))}
      </div>
    </section>

    <Hr />

    {
      featuredPosts.length > 0 && (
        <>
          <section id="featured" class="pt-12 pb-6">
            <h2 class="text-2xl font-semibold tracking-wide">Featured Blog Posts</h2>
            <ul>
              {featuredPosts.map((data) => (
                <Card variant="h3" {...data} showImage={false} />
              ))}
            </ul>
          </section>
          <div class="my-8 text-center">
            <LinkButton href="/posts">
              All Posts
              <IconArrowRight class="inline-block" />
            </LinkButton>
          </div>
        </>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
